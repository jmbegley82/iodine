CC          ?= cc
CXX         ?= c++
MKDIR_P     ?= mkdir -p
## COMMONFLAGS:
# -g is needed for debugging of any sort
# -DDEBUG enables building and execution of the following tests:
# -DDEBUGATOM enables the Atom tests in Atom.Test.cpp
# -DDEBUGLOGGER enables the Logger test in Logger.Test.c (lots of output, not enabled by default)
# -DDEBUGMOTION enables the Motion object tests in Motion.Test.cpp
# -DDEBUGTICKER enables the Ticker object tests in Ticker.Test.cpp
# -DDEBUGTIMING enables the Timing function tests in Timing.Test.c
# -DDEBUGEXTRA enables extra output during tests
COMMONFLAGS ?= -g -DDEBUG -DDEBUGATOM -DDEBUGMOTION -DDEBUGTICKER -DDEBUGTIMING -DDEBUGEXTRA
CFLAGS      ?= $(COMMONFLAGS)
CXXFLAGS    ?= $(COMMONFLAGS)
CPPFLAGS    ?= -I./src/
LDFLAGS     ?= -lpthread

BUILD_DIR   ?=./build
SRC_DIR     ?=./src

### no easily-user-serviceable parts below this line

SRCS:=$(shell find $(SRC_DIR) -name *.cpp -or -name *.c)
OBJS:=$(SRCS:%=$(BUILD_DIR)/%.o)
DEPS:=$(OBJS:.o=.d)

$(BUILD_DIR)/%.c.o: %.c
	$(MKDIR_P) $(dir $@)
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o $@

$(BUILD_DIR)/%.cpp.o: %.cpp
	$(MKDIR_P) $(dir $@)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o $@

$(BUILD_DIR)/iodine-test: $(OBJS)
	$(CXX) $(OBJS) -o $@ $(LDFLAGS)

bin:	$(BUILD_DIR)/iodine-test

doc:
	doxygen

all:	bin doc

.PHONY:	clean

clean:
	rm -rf build
	rm -rf doc
